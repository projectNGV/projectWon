/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/

#include "auth.h"
#include "asclin1.h"

#include <string.h>

/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/

volatile boolean g_isLogin = FALSE;

extern volatile boolean g_rx_getLine;
extern volatile char g_rx_buffer[];
extern volatile int g_rx_idx;

static const char *password = "1234";

/*********************************************************************************************************************/
/*--------------------------------------------Private Variables/Constants--------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------Function Prototypes------------------------------------------------*/
/*********************************************************************************************************************/

void authenticate(void);

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/

void authenticate (void)
{
    while (!g_isLogin)
    {
        if (g_rx_getLine)
        {
            myPrintf("Received from ISR: %s\n", (const char*) g_rx_buffer);
            if (strcmp((const char*) g_rx_buffer, password) == 0)
            {
                g_isLogin = TRUE;
                bluetoothPrintf("OK\n");
            }
            else
            {
                bluetoothPrintf("FAILED\n");
            }

            g_rx_idx = 0;
            memset((void*) g_rx_buffer, 0, RX_BUFFER_SIZE);
            g_rx_getLine = FALSE;
        }
    }
}

