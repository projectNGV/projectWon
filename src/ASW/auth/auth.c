/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/

#include "auth.h"
#include "asclin1.h"
#include "autopark.h"

#include <string.h>

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/

volatile boolean g_isLogin = FALSE;

extern volatile boolean g_rx_getLine;
extern volatile char g_rx_buffer[];

/*********************************************************************************************************************/
/*--------------------------------------------Private Variables/Constants--------------------------------------------*/
/*********************************************************************************************************************/

static const char *PASSWORD = "1234";

/*********************************************************************************************************************/
/*------------------------------------------------Function Prototypes------------------------------------------------*/
/*********************************************************************************************************************/

void authenticate (void);

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/

void authenticate (void)
{
    while (!g_isLogin)
    {
        bluetoothPrintf("?Input Password (tune - Tune Mode)\n");
        while (!g_rx_getLine)
            ;

        if (strcmp(g_rx_buffer, "tune") == 0)
        {
            rxBufferFlush();
            autoParkTune();
        }
        else if (strcmp((const char*) g_rx_buffer, PASSWORD) == 0)
        {
            g_isLogin = TRUE;
            bluetoothPrintf("!OK\n");
        }
        else
        {
            bluetoothPrintf("FAILED\n");
        }
        rxBufferFlush();
    }
}

