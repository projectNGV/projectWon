/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/

#include "ultrasonic.h"

/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/

#define STATE_FINDING_WALL 0
#define STATE_FOUND_EDGE 1
#define STATE_FOUND_REAR 2

#define WALL_DETECTED_DISTANCE 100000

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/

int g_CurrentState = STATE_FINDING_WALL;
int g_Prev_Distance;

/*********************************************************************************************************************/
/*--------------------------------------------Private Variables/Constants--------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------Function Prototypes------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/

void park ()
{
    g_CurrentState = STATE_FINDING_WALL;

    g_Prev_Distance = getDistanceByUltra(ULT_REAR);


    /**
     * TODO: GO RIGHT-BACK WARD
     * 뒤에 부딪히려고 할 때는 어떻게? -> 벽과 각도 안나와서 제대로 된 값 측정 불가능?
     * */

    int currentDistance;
    while (g_Prev_Distance - getDistanceByUltra(ULT_REAR) < 0)
    {
        delayMs(50);
    }

    g_CurrentState = STATE_FOUND_EDGE;
    while (g_Prev_Distance - getDistanceByUltra(ULT_REAR) > 0)
    {
        delayMs(50);
    }

    g_CurrentState = STATE_FOUND_REAR;
    while (getDistanceByUltra(ULT_RIGHT) > WALL_DETECTED_DISTANCE)
    {
        delayMs(50);
    }
    /**
     * TODO: LEVEL RIGHT
     *
     * */
}
